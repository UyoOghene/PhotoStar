<% layout('layouts/boilerplate') -%>



    <div class="container mb-3">
    <h1>view post</h1>
    <a href="/posts">Bact to all posts</a>
    <div class="box">
        <% for(let img of post.images ){ %>
        <img src="<%= img.url %>" alt="Post Image" class="img-fluid">
        <h1><%= post.caption %></h1>
        <% } %>
    </div>
    <a href="/posts/<%= post._id %>/edit">Edit</a>

    <h2>Leave a comment</h2>
    <form action="/posts/<%= post._id %>/comments" method="post" class="validated-form" novalidate>
        <div class="mb-3">
            <label for="body" class="form-label" >Comment</label>
            <textarea class="form-control"  name="comment[body]" id="body" cols="10" rows="3" required ></textarea>
            <div class="valid-feedback">Looks Good</div>
        </div>
        <button class="btn btn-success" >Submit comment</button>
    </form>


    <form action="/posts/<%= post._id %>?_method=DELETE" method="post">
        <button class="btn btn-danger">delete</button>
    </form>

    <% for (let comment of post.comments) { %>
        <div class="mb-3">
            <p><%= comment.body %> by: 
                <% if (comment.author) { %>
                    <%= comment.author.username || comment.author.email %>
                <% } else { %>
                    [Deleted User] 
                <% } %>
            </p>
            <li class="list-group-item">Submitted by <%= post.author.username %></li>
            
            <form action="/posts/<%= post._id %>/comments/<%= comment._id %>?_method=DELETE" method="post">
                <button class="btn btn-sm btn-danger">Delete</button>
            </form>
        </div>
    <% } %>
        </div>